# Pre-Commit Checklist — AnalyzerPro / MelechDSP

Use this checklist before every commit (especially when using Cursor/AI agents).  
Goal: prevent RT regressions, architectural drift, and “mystery diffs.”

---

## 1) Prompt Discipline

- [ ] This commit corresponds to **one prompt / one task**.
- [ ] The applied prompt is referenced in the commit message and/or PR description.
- [ ] The prompt’s **Scope** matches the files changed (no extras).
- [ ] If the work expanded, I split it into a **new prompt** (not bundled here).

---

## 2) File & Diff Hygiene

- [ ] Only intended files changed (no accidental formatting sweeps).
- [ ] No unrelated refactors, renames, or “cleanup while here.”
- [ ] No generated artifacts committed (DerivedData, build outputs, .DS_Store, etc.).
- [ ] No new debug noise in release builds (DBG/logging is debug-only or behind flags).

---

## 3) Real-Time Safety (DSP / Engine)

Applies to AnalyzerEngine, DSP, and anything called from `processBlock()`.

- [ ] No allocations on the audio thread:
  - [ ] no `new`, `make_unique`, `make_shared`
  - [ ] no `std::vector::resize`, `reserve`, `push_back` (unless provably preallocated and bounded)
  - [ ] no FFT object creation or buffer re-init from audio thread
- [ ] Any expensive changes are deferred (message thread / safe boundary).
- [ ] No locks in audio thread (or clearly justified and bounded).
- [ ] No I/O (file/network/console) on audio thread.

---

## 4) UI vs Engine Separation

- [ ] Engine owns DSP/state/buffers; UI owns mapping/clamping/animation.
- [ ] UI does **not** mutate engine buffers directly.
- [ ] Engine does **not** reference UI ranges, grid settings, colours, animation, or layout.
- [ ] No new coupling between UI and engine modules.

---

## 5) Parameters (APVTS)

- [ ] APVTS remains the single source of truth.
- [ ] Parameter reads in `processBlock()` are optimized where appropriate:
  - [ ] cached raw pointers used if introduced
  - [ ] setters only called when values change (if implemented)
- [ ] Choice/int params are range-checked (debug asserts OK; release guards where needed).
- [ ] Null pointers are guarded in Release builds (no “jassert-only safety”).

---

## 6) Correctness Checks (Manual Quick Tests)

Pick the minimal tests relevant to the change:

- [ ] Plugin loads (AU/VST3/AAX as applicable) without errors.
- [ ] Standalone opens audio device successfully (if standalone touched).
- [ ] If FFT/visualization touched:
  - [ ] FFT mode renders and updates with audio
  - [ ] Band/Log still render
  - [ ] No “blink to floor” regressions
- [ ] If peaks/hold touched:
  - [ ] Peak behavior matches mode
  - [ ] Reset Peaks works (button + shortcut if applicable)
- [ ] If UI controls/layout touched:
  - [ ] No clipping at minimum window size
  - [ ] Shortcut does not fire while typing in text inputs

---

## 7) Build & Warnings

- [ ] Build passes locally for the affected target(s).
- [ ] No new compiler warnings introduced.
- [ ] Debug asserts added are justified and do not spam.

---

## 8) Prompt Archival

- [ ] The applied prompt is moved to `PROMPTS/99_ARCHIVE/` or renamed with `DONE_`.
- [ ] If follow-up is needed, I created a new prompt file for it.

---

## 9) Commit Message

- [ ] Commit message includes prompt reference, e.g.:
  - `UI: Reset Peaks shortcut (PROMPTS/03_UI_CONTROLS/02_reset_peaks_keyboard_shortcut.txt)`
  - `ENGINE: Defer FFT resize (PROMPTS/01_ENGINE/02_deferred_fft_request_apply.txt)`

---